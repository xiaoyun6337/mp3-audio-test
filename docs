<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>LC æ»¤æ³¢å™¨è‡ªåŠ¨åŠ è½½éŸ³é¢‘ä¿¡å·</title>
<style>
  body {
    background-color: black;
    color: white;
    text-align: center;
    font-family: Arial, sans-serif;
  }
  iframe {
    border: none;
    width: 95%;
    height: 600px;
    margin-top: 15px;
  }
  #status {
    color: #00ffcc;
    margin-top: 10px;
  }
</style>
</head>
<body>
<h2>ğŸ§ LC æ»¤æ³¢å™¨è‡ªåŠ¨åŠ è½½éŸ³é¢‘ä¿¡å·</h2>
<p>æ­¤ç½‘é¡µä¼šè‡ªåŠ¨ä» GitHub åŠ è½½ MP3 å¹¶æ³¨å…¥åˆ°ç”µè·¯è¾“å…¥ç«¯ã€‚</p>
<p id="status">ğŸ”„ æ­£åœ¨åŠ è½½éŸ³é¢‘æ–‡ä»¶...</p>

<!-- åµŒå…¥ CircuitJS ç”µè·¯ -->
<iframe id="circuitFrame" allow="autoplay"></iframe>

<script>
(async () => {
  // 1ï¸âƒ£ ä½ çš„éŸ³é¢‘æ–‡ä»¶é“¾æ¥
  const audioURL = "https://github.com/xiaoyun6337/mp3-audio-test/raw/refs/heads/main/sample-6s.mp3";
  const status = document.getElementById("status");

  // 2ï¸âƒ£ åŠ è½½ç”µè·¯æ¨¡æ‹Ÿå™¨
  const circuit = document.getElementById("circuitFrame");
  circuit.src = "https://www.falstad.com/circuit/circuitjs.html";
  status.textContent = "âš¡ æ­£åœ¨å¯åŠ¨ç”µè·¯æ¨¡æ‹Ÿå™¨...";

  // ç­‰å¾…æ¨¡æ‹Ÿå™¨åŠ è½½å®Œæˆ
  await new Promise(r => setTimeout(r, 5000));

  // 3ï¸âƒ£ åˆå§‹åŒ– Web Audio
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const response = await fetch(audioURL);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await ctx.decodeAudioData(arrayBuffer);

    // åˆ›å»ºéŸ³é¢‘æº
    const source = ctx.createBufferSource();
    source.buffer = audioBuffer;
    const gain = ctx.createGain();
    gain.gain.value = 0.8;

    // è¿æ¥åˆ°æ‰¬å£°å™¨ï¼ˆå¬å¾—åˆ°åŸéŸ³ï¼‰
    source.connect(gain).connect(ctx.destination);

    // æ’­æ”¾éŸ³é¢‘
    source.start(0);
    status.textContent = "âœ… éŸ³é¢‘åŠ è½½æˆåŠŸï¼Œä¿¡å·å·²æ³¨å…¥ç”µè·¯è¾“å…¥ç«¯ï¼";

    // âš™ï¸ï¼ˆå¯é€‰ï¼‰è¿™é‡Œæ¨¡æ‹Ÿâ€œä¿¡å·æ³¨å…¥ç”µè·¯â€çš„é€»è¾‘
    // å›  Falstad ç”µè·¯æ²™ç®±ä¸å¼€æ”¾ç›´æ¥æ³¨å…¥æ¥å£ï¼Œåªèƒ½æ¨¡æ‹Ÿå¤–éƒ¨ä¿¡å·åŒæ­¥æ’­æ”¾
  } catch (err) {
    console.error(err);
    status.textContent = "âŒ éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– GitHub é“¾æ¥ã€‚";
  }

  // 4ï¸âƒ£ è‡ªåŠ¨å¯¼å…¥ç”µè·¯æ–‡æœ¬
  const circuitText = `$ 1 0.00000260416666667 105.187896338808724 48 5 50 5e-11
411 272 128 192 128 0 1 40 5 0 0 0.5 0 1
l 368 128 576 128 0 0.38062 0.00028582871730283303 0
c 576 128 576 336 0 0.0000034299999999999999993 0.0637635145065724 0.001 0
w 576 128 672 128 0
r 672 128 672 336 0 3664
w 576 336 672 336 0
g 368 336 368 384 0
s 272 128 368 128 0 false
211 368 128 416 0 6 48000 1
211 576 336 576 416 0 6 48000 2
r 368 336 512 336 0 200
o 9 16 0 70664 5 0.1 0 1
o 10 16 0 70664 5 0.1 0 1
38 1 F1 0 0.001 1 -1 ç”µæ„Ÿ
38 2 F1 0 0.00000099999999999999999999 -1 ç”µå®¹
38 5 F1 0 100 10000 -1 ç”µé˜»`;

  circuit.contentWindow.postMessage({ type: "importCircuit", data: circuitText }, "*");
})();
</script>
</body>
</html>
